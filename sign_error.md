# Best2Pay Invalid Signature - –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑

## üìã –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–ü—Ä–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –ø–ª–∞—Ç–µ–∂–Ω–æ–≥–æ —à–ª—é–∑–∞ Best2Pay (webapi/Register) –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞ **109 "Invalid signature"**.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ –∫–∞–±–∏–Ω–µ—Ç–∞ Best2Pay:**
- –ù–æ–º–µ—Ä —Å–µ–∫—Ç–æ—Ä–∞: `22436`
- –°–µ–∫—Ç–æ—Ä –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API: `fccdeb67-cc87-47f8-83c4-3fcddcbf765b`
- –ü–∞—Ä–æ–ª—å –¥–ª—è –ø–æ–¥–ø–∏—Å–∏: `X5e87TgD`

**–¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å:**
- sector: `22436`
- amount: `15000` (–∫–æ–ø–µ–µ–∫, —Ç.–µ. 150 —Ä—É–±–ª–µ–π)
- currency: `643` (RUB)
- password: `X5e87TgD`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```xml
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<error>
    <description>Invalid signature</description>
    <code>109</code>
</error>
```

---

## üìñ –ê–ª–≥–æ—Ä–∏—Ç–º —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–∏ (–∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Best2Pay)

### –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ:

**–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Ññ2: –ê–ª–≥–æ—Ä–∏—Ç–º —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Ü–∏—Ñ—Ä–æ–≤–æ–π –ø–æ–¥–ø–∏—Å–∏**

1. **–§–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è —Å—Ç—Ä–æ–∫–∞** –∏–∑ –∑–Ω–∞—á–µ–Ω–∏–π –∑–∞–¥–∞–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–∞ –ó–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤ –∏ –≤ –∫–æ–Ω—Ü–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ø–∞—Ä–æ–ª—å –¢–°–ü –¥–ª—è —Ü–∏—Ñ—Ä–æ–≤–æ–π –ø–æ–¥–ø–∏—Å–∏.

2. **–ü–æ–ª—É—á–µ–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤ —Ö—ç—à** –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º SHA256. –ù–∞–ø—Ä–∏–º–µ—Ä, —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ `CryptoJS.SHA256(str).toString()` –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ crypto-js.min.js. –ü—Ä–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏–∏ SHA256 –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è —Ä—É—Å—Å–∫–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –∫–æ–¥–∏—Ä–æ–≤–∫—É **UTF-8**.

3. **–ü–æ–ª—É—á–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Ö–µ—à–∞ –∫–æ–¥–∏—Ä—É–µ—Ç—Å—è** –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º Base64 (**–∫–æ–¥–∏—Ä—É–µ—Ç—Å—è –Ω–µ –µ–≥–æ –±–∏—Ç–æ–≤–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ, –∞ –µ–≥–æ —à–µ—Å—Ç–Ω–∞–¥—Ü–∞—Ç–µ—Ä–∏—á–Ω–æ–µ —Å—Ç—Ä–æ–∫–æ–≤–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –≤ –Ω–∏–∂–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ**) –≤ –∏—Ç–æ–≥–æ–≤—É—é —Ü–∏—Ñ—Ä–æ–≤—É—é –ø–æ–¥–ø–∏—Å—å signature. –ù–∞–ø—Ä–∏–º–µ—Ä, —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ `Base64.encode(sha256)` jquery.base64.js.

### –î–ª—è webapi/Register:

**–§–æ—Ä–º—É–ª–∞ –ø–æ–¥–ø–∏—Å–∏:**
```
str = sector + amount + currency + password
```

---

## üß™ –≠—Ç–∞–ª–æ–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Best2Pay

### –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
```
sector = 1
amount = 100
currency = 643
email = info@mail.ru
phone = 8911111111111
reference = 1s23d333d333
description = –û–ø–ª–∞—Ç–∞ —Ç–æ–≤–∞—Ä–∞ –Ω–æ—É—Ç–±—É–∫ ASUS X55A
password = test
```

### –í—ã—á–∏—Å–ª–µ–Ω–∏–µ:
```
str = sector + amount + currency + password
str = "1100643test"
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
```
sha256 = f665bf26a3d24e00b5646c829ea07cef67ed7a2af5eb1fbc258720c651136fee
signature = ZjY2NWJmMjZhM2QyNGUwMGI1NjQ2YzgyOWVhMDdjZWY2N2VkN2EyYWY1ZWIxZmJjMjU4NzIwYzY1MTEzNmZlZQ==
```

### –û—Ç–≤–µ—Ç (—É—Å–ø–µ—à–Ω—ã–π):
```xml
<?xml version="1.0" encoding="UTF-8"?>
<order>
    <id>561</id>
    <state>REGISTERED</state>
    <date>2014.07.10 15:07:45</date>
    <amount>100</amount>
    <currency>643</currency>
    <email>info@mail.ru</email>
    <phone>8911111111111</phone>
    <reference>1s23d333d333</reference>
    <description>–û–ø–ª–∞—Ç–∞ —Ç–æ–≤–∞—Ä–∞ –Ω–æ—É—Ç–±—É–∫ ASUS X55A</description>
    <signature>ZTBiMjk0NzBiMTcxYjUxMmQ2MzVjNTE5M2FiODNkZTk3N2FiZTFkMmQwNmY5YmEwZDdjYmYxODJmODMxMjdlYg==</signature>
</order>
```

---

## üíª –ù–∞—à–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (Python)

### –ö–æ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–æ–¥–ø–∏—Å–∏:

```python
import hashlib
import base64

def generate_signature(sector, amount, currency, password):
    """
    –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∏ –ø–æ –∞–ª–≥–æ—Ä–∏—Ç–º—É Best2Pay

    Args:
        sector: –ù–æ–º–µ—Ä —Å–µ–∫—Ç–æ—Ä–∞ (—Å—Ç—Ä–æ–∫–∞)
        amount: –°—É–º–º–∞ –≤ –∫–æ–ø–µ–π–∫–∞—Ö (int)
        currency: –ö–æ–¥ –≤–∞–ª—é—Ç—ã (—Å—Ç—Ä–æ–∫–∞)
        password: –ü–∞—Ä–æ–ª—å –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ (—Å—Ç—Ä–æ–∫–∞)

    Returns:
        str: Base64 –ø–æ–¥–ø–∏—Å—å
    """
    # –®–∞–≥ 1: –§–æ—Ä–º–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫—É
    signature_string = f"{sector}{amount}{currency}{password}"

    # –®–∞–≥ 2: –í—ã—á–∏—Å–ª—è–µ–º SHA256 (UTF-8 –∫–æ–¥–∏—Ä–æ–≤–∫–∞)
    sha256_hash = hashlib.sha256(signature_string.encode('utf-8')).hexdigest().lower()

    # –®–∞–≥ 3: Base64 –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ HEX-—Å—Ç—Ä–æ–∫–∏ (–Ω–µ –±–∏—Ç–æ–≤–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è!)
    signature = base64.b64encode(sha256_hash.encode('utf-8')).decode('utf-8')

    return signature
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

```python
signature = generate_signature(
    sector="22436",
    amount=15000,      # 150 —Ä—É–±–ª–µ–π = 15000 –∫–æ–ø–µ–µ–∫
    currency="643",     # RUB
    password="X5e87TgD"
)
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –Ω–∞ —ç—Ç–∞–ª–æ–Ω–Ω–æ–º –ø—Ä–∏–º–µ—Ä–µ

### –¢–µ—Å—Ç —Å –ø—Ä–∏–º–µ—Ä–æ–º –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:

```python
# –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
sector = "1"
amount = "100"
currency = "643"
password = "test"

# –í—ã—á–∏—Å–ª–µ–Ω–∏–µ
str_value = f"{sector}{amount}{currency}{password}"
# –†–µ–∑—É–ª—å—Ç–∞—Ç: "1100643test"

sha256_value = hashlib.sha256(str_value.encode('utf-8')).hexdigest().lower()
# –†–µ–∑—É–ª—å—Ç–∞—Ç: f665bf26a3d24e00b5646c829ea07cef67ed7a2af5eb1fbc258720c651136fee

signature_value = base64.b64encode(sha256_value.encode('utf-8')).decode('utf-8')
# –†–µ–∑—É–ª—å—Ç–∞—Ç: ZjY2NWJmMjZhM2QyNGUwMGI1NjQ2YzgyOWVhMDdjZWY2N2VkN2EyYWY1ZWIxZmJjMjU4NzIwYzY1MTEzNmZlZQ==
```

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ:

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–∂–∏–¥–∞–µ—Ç—Å—è (–∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏) | –ü–æ–ª—É—á–µ–Ω–æ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|----------|----------------------------|----------|-----------|
| –°—Ç—Ä–æ–∫–∞ | `1100643test` | `1100643test` | ‚úÖ –°–û–í–ü–ê–î–ê–ï–¢ |
| SHA256 | `f665bf26a3d24e00b5646c829ea07cef67ed7a2af5eb1fbc258720c651136fee` | `f665bf26a3d24e00b5646c829ea07cef67ed7a2af5eb1fbc258720c651136fee` | ‚úÖ –°–û–í–ü–ê–î–ê–ï–¢ |
| Signature | `ZjY2NWJmMjZhM2QyNGUwMGI1NjQ2YzgyOWVhMDdjZWY2N2VkN2EyYWY1ZWIxZmJjMjU4NzIwYzY1MTEzNmZlZQ==` | `ZjY2NWJmMjZhM2QyNGUwMGI1NjQ2YzgyOWVhMDdjZWY2N2VkN2EyYWY1ZWIxZmJjMjU4NzIwYzY1MTEzNmZlZQ==` | ‚úÖ –°–û–í–ü–ê–î–ê–ï–¢ |

**–í—ã–≤–æ–¥:** ‚úÖ‚úÖ‚úÖ **–ê–õ–ì–û–†–ò–¢–ú –†–ê–ë–û–¢–ê–ï–¢ –ü–†–ê–í–ò–õ–¨–ù–û!**

---

## üî¨ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫ –Ω–∞—à–∏–º —Ä–µ–∞–ª—å–Ω—ã–º –¥–∞–Ω–Ω—ã–º

### –í—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
```
sector = "22436"
amount = "15000"  (150 —Ä—É–±–ª–µ–π –≤ –∫–æ–ø–µ–π–∫–∞—Ö)
currency = "643"
password = "X5e87TgD"
```

### –í—ã—á–∏—Å–ª–µ–Ω–∏–µ:

**–®–∞–≥ 1: –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏**
```
str = "2243615000643X5e87TgD"
```

–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:
- –î–ª–∏–Ω–∞: 21 —Å–∏–º–≤–æ–ª
- UTF-8 bytes (hex): `323234333631353030303634335835653837546744`
- –ü–æ—Å–∏–º–≤–æ–ª—å–Ω–æ:
  ```
  [0] '2' = 50 (0x32)
  [1] '2' = 50 (0x32)
  [2] '4' = 52 (0x34)
  [3] '3' = 51 (0x33)
  [4] '6' = 54 (0x36)
  [5] '1' = 49 (0x31)
  [6] '5' = 53 (0x35)
  [7] '0' = 48 (0x30)
  [8] '0' = 48 (0x30)
  [9] '0' = 48 (0x30)
  [10] '6' = 54 (0x36)
  [11] '4' = 52 (0x34)
  [12] '3' = 51 (0x33)
  [13] 'X' = 88 (0x58)
  [14] '5' = 53 (0x35)
  [15] 'e' = 101 (0x65)
  [16] '8' = 56 (0x38)
  [17] '7' = 55 (0x37)
  [18] 'T' = 84 (0x54)
  [19] 'g' = 103 (0x67)
  [20] 'D' = 68 (0x44)
  ```

**–®–∞–≥ 2: SHA256**
```
sha256 = dac0f6a096635fb77389ea915f58906536bcddeee7f9d1cc6da70aca2e00bcf1
```

**–®–∞–≥ 3: Base64**
```
signature = ZGFjMGY2YTA5NjYzNWZiNzczODllYTkxNWY1ODkwNjUzNmJjZGRlZWU3ZjlkMWNjNmRhNzBhY2EyZTAwYmNmMQ==
```

### –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –∫ API:

**Payload:**
```json
{
  "sector": "22436",
  "amount": 15000,
  "currency": "643",
  "description": "Test payment",
  "reference": "test_123",
  "signature": "ZGFjMGY2YTA5NjYzNWZiNzczODllYTkxNWY1ODkwNjUzNmJjZGRlZWU3ZjlkMWNjNmRhNzBhY2EyZTAwYmNmMQ=="
}
```

**–û—Ç–≤–µ—Ç –æ—Ç Best2Pay:**
```xml
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<error>
    <description>Invalid signature</description>
    <code>109</code>
</error>
```

---

## üßê –ß—Ç–æ –±—ã–ª–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ

### ‚úÖ –ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ–¥–ø–∏—Å–∏:
- [x] –ü–æ—Ä—è–¥–æ–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤: `sector + amount + currency + password`
- [x] UTF-8 –∫–æ–¥–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏–∏ SHA256
- [x] SHA256 –≤ lowercase (–Ω–∏–∂–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä)
- [x] Base64 –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ HEX-—Å—Ç—Ä–æ–∫–∏ (–Ω–µ –±–∏—Ç–æ–≤–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è)
- [x] –¢–µ—Å—Ç –Ω–∞ —ç—Ç–∞–ª–æ–Ω–Ω–æ–º –ø—Ä–∏–º–µ—Ä–µ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ - **–£–°–ü–ï–®–ù–û**

### ‚úÖ –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö:
- [x] amount –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –∫–∞–∫ integer –≤ –∫–æ–ø–µ–π–∫–∞—Ö (15000, –Ω–µ 150.0)
- [x] currency = "643" (RUB)
- [x] sector –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞ "22436"
- [x] password –±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤ –≤ –Ω–∞—á–∞–ª–µ/–∫–æ–Ω—Ü–µ

### ‚úÖ –†–∞–∑–ª–∏—á–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:
- [x] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ UUID –≤–º–µ—Å—Ç–æ —á–∏—Å–ª–æ–≤–æ–≥–æ ID - **–û–®–ò–ë–ö–ê 102**
- [x] –°–º–µ—à–∞–Ω–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (UUID –≤ –∑–∞–ø—Ä–æ—Å–µ, —á–∏—Å–ª–æ–≤–æ–π –≤ –ø–æ–¥–ø–∏—Å–∏) - **–û–®–ò–ë–ö–ê 102/109**
- [x] –†–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø–æ—Ö–æ–∂–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤ –≤ –ø–∞—Ä–æ–ª–µ - **–í–°–ï –û–®–ò–ë–ö–ê 109**

### ‚úÖ –ú–µ—Ç–æ–¥—ã –æ—Ç–ø—Ä–∞–≤–∫–∏:
- [x] `data=dict` —Å integer amount
- [x] `data=dict` —Å string amount
- [x] `FormData`
- [x] –í—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç **–û–®–ò–ë–ö–ê 109**

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤

| –¢–µ—Å—Ç | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|------|-----------|-----------|
| –≠—Ç–∞–ª–æ–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä (sector=1, password=test) | –ü–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ | ‚úÖ –£–°–ü–ï–• |
| Numeric ID + Password | sector=22436, password=X5e87TgD | ‚ùå Error 109 |
| UUID + Password | sector=fccdeb67-..., password=X5e87TgD | ‚ùå Error 102 |
| UUID –≤ –∑–∞–ø—Ä–æ—Å–µ, Numeric –≤ –ø–æ–¥–ø–∏—Å–∏ | –°–º–µ—à–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ | ‚ùå Error 102 |
| Numeric –≤ –∑–∞–ø—Ä–æ—Å–µ, UUID –≤ –ø–æ–¥–ø–∏—Å–∏ | –û–±—Ä–∞—Ç–Ω—ã–π –ø–æ–¥—Ö–æ–¥ | ‚ùå Error 109 |
| –í–∞—Ä–∏–∞–Ω—Ç—ã –ø–∞—Ä–æ–ª—è (X5e87TgO, X5e87Tg0, etc.) | 11 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ | ‚ùå –í—Å–µ Error 109 |

---

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

### –ß—Ç–æ —Ç–æ—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ:
1. ‚úÖ –ê–ª–≥–æ—Ä–∏—Ç–º —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω **–ö–û–†–†–ï–ö–¢–ù–û**
2. ‚úÖ –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º API
3. ‚úÖ –ü–æ—Ä—è–¥–æ–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
4. ‚úÖ –ö–æ–¥–∏—Ä–æ–≤–∫–∞ UTF-8 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
5. ‚úÖ Base64 –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ HEX-—Å—Ç—Ä–æ–∫–∏ (–Ω–µ –±–∏—Ç–æ–≤) —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### –ü—Ä–æ–±–ª–µ–º–∞:
üî¥ **–ü–∞—Ä–æ–ª—å `X5e87TgD` –ù–ï –°–û–í–ü–ê–î–ê–ï–¢ —Å —Ä–µ–∞–ª—å–Ω—ã–º –ø–∞—Ä–æ–ª–µ–º –≤ —Å–∏—Å—Ç–µ–º–µ Best2Pay**

### –î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞:
1. –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —ç—Ç–∞–ª–æ–Ω–Ω–æ–º –ø—Ä–∏–º–µ—Ä–µ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
2. –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
3. Best2Pay –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É 109 "Invalid signature"
4. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è –º–µ–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –Ω–æ –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ

### –í–µ—Ä–æ—è—Ç–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
- –ü–∞—Ä–æ–ª—å –Ω–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π (–ø–æ—Ö–æ–∂–∏–µ —Å–∏–º–≤–æ–ª—ã)
- –ü–∞—Ä–æ–ª—å –±—ã–ª –∏–∑–º–µ–Ω–µ–Ω –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Å–∫—Ä–∏–Ω—à–æ—Ç–∞
- –ü–∞—Ä–æ–ª—å –≤ –∫–∞–±–∏–Ω–µ—Ç–µ –∑–∞–º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω –∏ —Ç—Ä–µ–±—É–µ—Ç —Ä–∞—Å–∫—Ä—ã—Ç–∏—è
- –í —Å–∏—Å—Ç–µ–º–µ Best2Pay –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥—Ä—É–≥–æ–π –ø–∞—Ä–æ–ª—å

---

## ‚ùì –í–æ–ø—Ä–æ—Å—ã –¥–ª—è —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∏ Best2Pay

### –ü–∏—Å—å–º–æ –≤ —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫—É:

```
–¢–µ–º–∞: –û—à–∏–±–∫–∞ 109 "Invalid signature" –ø—Ä–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ webapi/Register

–î–æ–±—Ä—ã–π –¥–µ–Ω—å!

–ò–Ω—Ç–µ–≥—Ä–∏—Ä—É—é –ø–ª–∞—Ç–µ–∂–Ω—ã–π —à–ª—é–∑ Best2Pay —á–µ—Ä–µ–∑ API (webapi/Register).

–ü–†–û–ë–õ–ï–ú–ê:
–ü–æ–ª—É—á–∞—é –æ—à–∏–±–∫—É 109 "Invalid signature" –ø—Ä–∏ –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–∫–∞—Ö —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∑–∞–∫–∞–∑–∞.

–ù–ê–®–ò –ü–ê–†–ê–ú–ï–¢–†–´:
- –ù–æ–º–µ—Ä —Å–µ–∫—Ç–æ—Ä–∞: 22436
- –°–µ–∫—Ç–æ—Ä –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API: fccdeb67-cc87-47f8-83c4-3fcddcbf765b
- –ü–∞—Ä–æ–ª—å –∏–∑ –∫–∞–±–∏–Ω–µ—Ç–∞: X5e87TgD

–ê–õ–ì–û–†–ò–¢–ú –ü–û–î–ü–ò–°–ò:
–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Å—Ç—Ä–æ–≥–æ –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Ññ2):
1. str = sector + amount + currency + password
2. SHA256(str) –≤ UTF-8 –∫–æ–¥–∏—Ä–æ–≤–∫–µ
3. Base64(hex_string) - –∫–æ–¥–∏—Ä—É–µ—Ç—Å—è HEX-—Å—Ç—Ä–æ–∫–∞, –Ω–µ –±–∏—Ç–æ–≤–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ

–ü–†–û–í–ï–†–ö–ê:
–ê–ª–≥–æ—Ä–∏—Ç–º –ø—Ä–æ–≤–µ—Ä–µ–Ω –Ω–∞ —ç—Ç–∞–ª–æ–Ω–Ω–æ–º –ø—Ä–∏–º–µ—Ä–µ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:
- sector=1, amount=100, currency=643, password=test
- –û–∂–∏–¥–∞–µ–º–∞—è –ø–æ–¥–ø–∏—Å—å: ZjY2NWJmMjZhM2QyNGUwMGI1NjQ2YzgyOWVhMDdjZWY2N2VkN2EyYWY1ZWIxZmJjMjU4NzIwYzY1MTEzNmZlZQ==
- –ù–∞—à–∞ –ø–æ–¥–ø–∏—Å—å: ZjY2NWJmMjZhM2QyNGUwMGI1NjQ2YzgyOWVhMDdjZWY2N2VkN2EyYWY1ZWIxZmJjMjU4NzIwYzY1MTEzNmZlZQ==
- –†–µ–∑—É–ª—å—Ç–∞—Ç: ‚úÖ –ü–û–õ–ù–û–ï –°–û–í–ü–ê–î–ï–ù–ò–ï

–¢–ï–°–¢–û–í–´–ô –ó–ê–ü–†–û–°:
POST https://pay.best2pay.net/webapi/Register
{
  "sector": "22436",
  "amount": 15000,
  "currency": "643",
  "description": "Test payment",
  "reference": "test_123",
  "signature": "ZGFjMGY2YTA5NjYzNWZiNzczODllYTkxNWY1ODkwNjUzNmJjZGRlZWU3ZjlkMWNjNmRhNzBhY2EyZTAwYmNmMQ=="
}

–û–¢–í–ï–¢:
<?xml version="1.0" encoding="UTF-8"?>
<error>
    <description>Invalid signature</description>
    <code>109</code>
</error>

–í–û–ü–†–û–°–´:
1. –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø–∞—Ä–æ–ª—å "X5e87TgD" –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –∫–∞–±–∏–Ω–µ—Ç–∞?
2. –ú–æ–∂–µ—Ç –ª–∏ —Ä–µ–∞–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –æ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–≥–æ?
3. –ú–æ–∂–µ—Ç–µ –ª–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å/–≤—ã—Å–ª–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å –¥–ª—è –ø–æ–¥–ø–∏—Å–∏?
4. –ù—É–∂–Ω—ã –ª–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ API?
5. –ï—Å—Ç—å –ª–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ IP-–∞–¥—Ä–µ—Å–∞–º –¥–ª—è –Ω–∞—à–µ–≥–æ —Å–µ–∫—Ç–æ—Ä–∞?

–î–ï–¢–ê–õ–ò –î–õ–Ø –ü–†–û–í–ï–†–ö–ò:
- –°—Ç—Ä–æ–∫–∞ –¥–ª—è –ø–æ–¥–ø–∏—Å–∏: "2243615000643X5e87TgD"
- SHA256: dac0f6a096635fb77389ea915f58906536bcddeee7f9d1cc6da70aca2e00bcf1
- Signature: ZGFjMGY2YTA5NjYzNWZiNzczODllYTkxNWY1ODkwNjUzNmJjZGRlZWU3ZjlkMWNjNmRhNzBhY2EyZTAwYmNmMQ==

–ú–æ–∂–µ—Ç–µ –ª–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ —Å–≤–æ–µ–π —Å—Ç–æ—Ä–æ–Ω–µ, –ø—Ä–∞–≤–∏–ª—å–Ω–∞ –ª–∏ —ç—Ç–∞ –ø–æ–¥–ø–∏—Å—å –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤?

–ó–∞—Ä–∞–Ω–µ–µ –±–ª–∞–≥–æ–¥–∞—Ä—é –∑–∞ –ø–æ–º–æ—â—å!
```

---

## üõ†Ô∏è –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å –∏–∑ –∫–∞–±–∏–Ω–µ—Ç–∞

1. –û—Ç–∫—Ä—ã—Ç—å –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç Best2Pay
2. –ù–∞–π—Ç–∏ —Ä–∞–∑–¥–µ–ª "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ç–æ—Ä–∞–º–∏" ‚Üí –°–µ–∫—Ç–æ—Ä 22436
3. –ù–∞–π—Ç–∏ –ø–æ–ª–µ "–ü–∞—Ä–æ–ª—å –¥–ª—è –ø–æ–¥–ø–∏—Å–∏"
4. **–°–ö–û–ü–ò–†–û–í–ê–¢–¨** –ø–∞—Ä–æ–ª—å (–Ω–µ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é!)
5. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ç–µ—Å—Ç:
   ```bash
   python3 /home/ubuntu/remnawave-tg-shop/test_with_real_password.py
   ```
6. –í—Å—Ç–∞–≤–∏—Ç—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å
7. –ï—Å–ª–∏ —Ç–µ—Å—Ç —É—Å–ø–µ—à–µ–Ω ‚Üí –æ–±–Ω–æ–≤–∏—Ç—å `.env`

### –í–∞—Ä–∏–∞–Ω—Ç 2: –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å

1. –í –∫–∞–±–∏–Ω–µ—Ç–µ Best2Pay –Ω–∞–π—Ç–∏ –∫–Ω–æ–ø–∫—É "–ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å" –∏–ª–∏ "–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å"
2. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å
3. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ
4. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ç–µ—Å—Ç (—Å–º. –≤—ã—à–µ)
5. –û–±–Ω–æ–≤–∏—Ç—å `.env`

### –í–∞—Ä–∏–∞–Ω—Ç 3: –û–±—Ä–∞—Ç–∏—Ç—å—Å—è –≤ —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫—É

–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–∏—Å—å–º–æ (—Ç–µ–∫—Å—Ç –≤—ã—à–µ) –≤ —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫—É Best2Pay –∏ –¥–æ–∂–¥–∞—Ç—å—Å—è –æ—Ç–≤–µ—Ç–∞.

---

## üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –£—Å–ø–µ—à–Ω—ã–π –∑–∞–∫–∞–∑ –∏–∑ –∫–∞–±–∏–Ω–µ—Ç–∞

–ù–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–µ –∏–∑ –∫–∞–±–∏–Ω–µ—Ç–∞ –≤–∏–¥–µ–Ω —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –∑–∞–∫–∞–∑:
- Order ID: 2691171254
- Amount: 100.00 RUB
- Status: REGISTERED
- Date: 2025.10.14 19:23:08

**URL –¥–ª—è –æ–ø–ª–∞—Ç—ã:**
```
https://pay.best2pay.net/webapi/Purchase?sector=22436&signature=NWQ2NGY0M0...&id=2691171254
```

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: –≤ URL –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **—á–∏—Å–ª–æ–≤–æ–π sector=22436**, –Ω–µ UUID.

### –¢–µ—Å—Ç–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã

–°–æ–∑–¥–∞–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:

1. **test_with_real_password.py** - –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ç–µ—Å—Ç —Å –≤–≤–æ–¥–æ–º –ø–∞—Ä–æ–ª—è
2. **test_exact_example.py** - –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–∞ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
3. **test_signature_exact.py** - –î–µ—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–ª–≥–æ—Ä–∏—Ç–º–∞
4. **test_best2pay_debug.py** - –¢–µ—Å—Ç —Ä–∞–∑–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –æ—Ç–ø—Ä–∞–≤–∫–∏
5. **test_best2pay_password_variants.py** - –¢–µ—Å—Ç –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –ø–∞—Ä–æ–ª—è
6. **test_best2pay_mixed.py** - –¢–µ—Å—Ç —Å–º–µ—à–∞–Ω–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è UUID/ID
7. **test_final_request.py** - –§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç —Å –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω–æ–π –ø–æ–¥–ø–∏—Å—å—é

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞ –≤ –ø—Ä–æ–µ–∫—Ç–µ

**–§–∞–π–ª:** `/home/ubuntu/remnawave-tg-shop/bot/services/best2pay_service.py`

–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:
- `_generate_signature(data: str)` - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∏
- `register_order()` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–∫–∞–∑–∞ (webapi/Register)
- `create_payment_url()` - –°–æ–∑–¥–∞–Ω–∏–µ URL –¥–ª—è –æ–ø–ª–∞—Ç—ã (webapi/PurchaseSBP)
- `verify_signature()` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ –≤ webhook

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** `/home/ubuntu/remnawave-tg-shop/.env`
```env
BEST2PAY_SECTOR_ID=22436
BEST2PAY_SECTOR_UUID=fccdeb67-cc87-47f8-83c4-3fcddcbf765b
BEST2PAY_PASSWORD=X5e87TgD
BEST2PAY_ENABLED=True
```

---

## üìö –°—Å—ã–ª–∫–∏ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Best2Pay:** B2P API - –û–±—â–∞—è v2.18.1.pdf
- **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Ññ2:** –ê–ª–≥–æ—Ä–∏—Ç–º —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Ü–∏—Ñ—Ä–æ–≤–æ–π –ø–æ–¥–ø–∏—Å–∏ (—Å—Ç—Ä–∞–Ω–∏—Ü–∞ ~456)
- **webapi/Register:** –û–ø–∏—Å–∞–Ω–∏–µ –º–µ—Ç–æ–¥–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∑–∞–∫–∞–∑–∞ (—Å—Ç—Ä–∞–Ω–∏—Ü–∞ ~13)
- **webapi/PurchaseSBP:** –û–ø–∏—Å–∞–Ω–∏–µ –º–µ—Ç–æ–¥–∞ –æ–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ –°–ë–ü (—Å—Ç—Ä–∞–Ω–∏—Ü–∞ ~414)

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-10-14
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-10-14
**–°—Ç–∞—Ç—É—Å:** –û–∂–∏–¥–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–∞—Ä–æ–ª—è –æ—Ç Best2Pay
